<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title data-i18n="app.title">Medaldex</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/i18n.js" defer></script>
</head>
<body class="bg-gradient-to-b from-black via-gray-900 to-gray-800 text-white flex flex-col min-h-screen">

  <!-- Navbar -->
  <nav class="flex justify-between items-center p-4 bg-gray-900 border-b border-gray-700">
    <a href="/" class="text-2xl font-bold">Medaldex</a>
    <div class="flex items-center space-x-3" id="navCtas">
      <!-- Remplac√© dynamiquement selon session -->
      <button id="openLogin" class="hidden bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded font-semibold" data-i18n="buttons.login">
        Se connecter
      </button>
      <button id="openSignup" class="hidden bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded font-semibold" data-i18n="buttons.signup">
        Cr√©er un compte
      </button>

      <a id="goDashboard" href="/dashboard/" class="hidden bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded font-semibold">
        Dashboard
      </a>
      <button id="logoutBtn" class="hidden bg-red-600 hover:bg-red-700 px-4 py-2 rounded font-semibold" data-i18n="buttons.logout">
        D√©connexion
      </button>

      <select id="langSwitcher" class="bg-gray-800 text-gray-200 border border-gray-600 rounded p-1">
        <option value="fr">üá´üá∑ FR</option>
        <option value="en">üá¨üáß EN</option>
      </select>
    </div>
  </nav>

  <!-- Hero -->
  <header class="flex-1 flex flex-col justify-center items-center text-center px-6 py-16">
    <h1 class="text-4xl md:text-6xl font-bold mb-6" data-i18n="app.slogan">
      Organise et r√©f√©rence ta collection de d√©corations
    </h1>
    <p class="text-lg md:text-xl text-gray-300 max-w-2xl mb-8" data-i18n="hero.desc">
      Medaldex est ton Pok√©dex des d√©corations : ajoute, g√®re et explore ta collection comme jamais auparavant.
    </p>
    <div class="flex space-x-4">
      <button id="heroSignup" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded font-semibold text-lg" data-i18n="buttons.signup">
        Cr√©er un compte
      </button>
      <button id="heroLogin" class="bg-gray-700 hover:bg-gray-800 px-6 py-3 rounded font-semibold text-lg" data-i18n="buttons.login">
        Se connecter
      </button>
      <a id="heroDashboard" href="/dashboard/" class="hidden bg-gray-700 hover:bg-gray-800 px-6 py-3 rounded font-semibold text-lg">
        Dashboard
      </a>
    </div>
  </header>

  <!-- Features -->
  <section class="py-16 bg-gray-900 text-center">
    <h2 class="text-3xl font-bold mb-4" data-i18n="features.title">Fonctionnalit√©s principales</h2>
    <p class="text-gray-400 mb-10" data-i18n="features.subtitle">Tout ce qu‚Äôil te faut pour g√©rer ta collection</p>
    <div class="grid md:grid-cols-3 gap-8 px-6 max-w-5xl mx-auto">
      <div class="bg-gray-800 p-6 rounded-lg shadow">
        <h3 class="font-semibold text-xl mb-2">üìÇ</h3>
        <p data-i18n="features.organize">Classe tes entr√©es par pays, √©poque, type, fabricant.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg shadow">
        <h3 class="font-semibold text-xl mb-2">üîé</h3>
        <p data-i18n="features.search">Trouve instantan√©ment l‚Äôentr√©e que tu veux.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg shadow">
        <h3 class="font-semibold text-xl mb-2">üìä</h3>
        <p data-i18n="features.stats">D√©couvre des statistiques sur ta collection.</p>
      </div>
    </div>
  </section>

  <!-- How it works -->
  <section class="py-16 text-center px-6">
    <h2 class="text-3xl font-bold mb-6">üöÄ Comment √ßa marche ?</h2>
    <div class="grid md:grid-cols-3 gap-8 max-w-5xl mx-auto">
      <div class="bg-gray-800 p-6 rounded-lg shadow">
        <h3 class="font-bold text-xl mb-2">1Ô∏è‚É£ Cr√©e un compte</h3>
        <p>Inscris-toi gratuitement en quelques secondes.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg shadow">
        <h3 class="font-bold text-xl mb-2">2Ô∏è‚É£ Ajoute tes entr√©es</h3>
        <p>Ajoute m√©dailles, insignes, rubans avec description et photo.</p>
      </div>
      <div class="bg-gray-800 p-6 rounded-lg shadow">
        <h3 class="font-bold text-xl mb-2">3Ô∏è‚É£ Explore ta collection</h3>
        <p>Filtre, recherche et d√©couvre tes statistiques.</p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 border-t border-gray-700 p-6 text-center text-gray-400">
    <p data-i18n="footer.rights">¬© 2025 Medaldex. Tous droits r√©serv√©s.</p>
    <div class="mt-4 flex justify-center space-x-6 text-sm">
      <a href="/legal/" class="hover:text-blue-400">Mentions l√©gales</a>
      <a href="/privacy/" class="hover:text-blue-400">Confidentialit√©</a>
      <a href="/terms/" class="hover:text-blue-400">Conditions d‚Äôutilisation</a>
      <a href="/contact/" class="hover:text-blue-400">Contact</a>
    </div>
  </footer>

  <!-- Cookie Banner -->
  <div id="cookieBanner" class="fixed bottom-0 left-0 right-0 bg-gray-800 text-gray-200 p-4 flex justify-between items-center shadow-lg">
    <p>üç™ Ce site utilise uniquement des cookies techniques n√©cessaires √† son fonctionnement.</p>
    <button id="acceptCookies" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded">OK</button>
  </div>

  <!-- Modals -->
  <div id="modalBackdrop" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-40"></div>

  <!-- Login modal -->
  <div id="loginModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="bg-gray-900 border border-gray-700 rounded-xl shadow-xl w-full max-w-md p-6 relative">
      <button data-close class="absolute top-3 right-3 w-8 h-8 rounded-full bg-gray-800 hover:bg-gray-700">‚úï</button>
      <h3 class="text-xl font-bold mb-4" data-i18n="buttons.login">Se connecter</h3>
      <form id="loginForm" class="space-y-4">
        <input id="loginEmail" type="email" data-i18n-placeholder="auth.email"
               class="w-full p-2 rounded bg-gray-800 border border-gray-600"/>
        <input id="loginPassword" type="password" data-i18n-placeholder="auth.password"
               class="w-full p-2 rounded bg-gray-800 border border-gray-600"/>
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 py-2 rounded font-semibold" data-i18n="buttons.login">
          Se connecter
        </button>
      </form>
    </div>
  </div>

  <!-- Signup modal -->
  <div id="signupModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="bg-gray-900 border border-gray-700 rounded-xl shadow-xl w-full max-w-md p-6 relative">
      <button data-close class="absolute top-3 right-3 w-8 h-8 rounded-full bg-gray-800 hover:bg-gray-700">‚úï</button>
      <h3 class="text-xl font-bold mb-4" data-i18n="buttons.signup">Cr√©er un compte</h3>
      <form id="signupForm" class="space-y-4">
        <input id="signupUsername" type="text" data-i18n-placeholder="auth.username"
               class="w-full p-2 rounded bg-gray-800 border border-gray-600"/>
        <input id="signupEmail" type="email" data-i18n-placeholder="auth.email"
               class="w-full p-2 rounded bg-gray-800 border border-gray-600"/>
        <input id="signupPassword" type="password" data-i18n-placeholder="auth.password"
               class="w-full p-2 rounded bg-gray-800 border border-gray-600"/>
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 py-2 rounded font-semibold" data-i18n="buttons.signup">
          Cr√©er un compte
        </button>
      </form>
      <p class="text-xs text-gray-400 mt-3">Un e-mail de confirmation peut √™tre n√©cessaire.</p>
    </div>
  </div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    import { loadConfig } from "/config.js";

    // Supabase client
    const { SUPABASE_URL, SUPABASE_ANON_KEY } = await loadConfig();
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Elements
    const openLogin = document.getElementById("openLogin");
    const openSignup = document.getElementById("openSignup");
    const heroLogin = document.getElementById("heroLogin");
    const heroSignup = document.getElementById("heroSignup");
    const heroDashboard = document.getElementById("heroDashboard");
    const goDashboard = document.getElementById("goDashboard");
    const logoutBtn = document.getElementById("logoutBtn");

    const modalBackdrop = document.getElementById("modalBackdrop");
    const loginModal = document.getElementById("loginModal");
    const signupModal = document.getElementById("signupModal");

    // Session detection
    const { data: { user } } = await supabase.auth.getUser();
    if (user) {
      // connect√©
      openLogin.classList.add("hidden");
      openSignup.classList.add("hidden");
      heroLogin.classList.add("hidden");
      heroSignup.classList.add("hidden");

      goDashboard.classList.remove("hidden");
      heroDashboard.classList.remove("hidden");
      logoutBtn.classList.remove("hidden");
    } else {
      // pas connect√©
      openLogin.classList.remove("hidden");
      openSignup.classList.remove("hidden");
      heroLogin.classList.remove("hidden");
      heroSignup.classList.remove("hidden");

      goDashboard.classList.add("hidden");
      heroDashboard.classList.add("hidden");
      logoutBtn.classList.add("hidden");
    }

    // Open/close modal helpers
    function openModal(which) {
      modalBackdrop.classList.remove("hidden");
      (which === "login" ? loginModal : signupModal).classList.remove("hidden");
    }
    function closeModals() {
      modalBackdrop.classList.add("hidden");
      loginModal.classList.add("hidden");
      signupModal.classList.add("hidden");
    }

    // Open modal buttons
    openLogin?.addEventListener("click", () => openModal("login"));
    heroLogin?.addEventListener("click", () => openModal("login"));
    openSignup?.addEventListener("click", () => openModal("signup"));
    heroSignup?.addEventListener("click", () => openModal("signup"));

    // Close modal (X buttons + backdrop + ESC)
    document.querySelectorAll("[data-close]").forEach(btn => btn.addEventListener("click", closeModals));
    modalBackdrop.addEventListener("click", closeModals);
    window.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModals(); });

    // Auth: login
    document.getElementById("loginForm")?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value;

      const { error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) return alert("‚ùå " + error.message);

      window.location.href = "/dashboard/";
    });

    // Auth: signup (+ create profile if possible)
    document.getElementById("signupForm")?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("signupUsername").value.trim();
      const email = document.getElementById("signupEmail").value.trim();
      const password = document.getElementById("signupPassword").value;

      if (!username || !email || !password) return alert("‚ö†Ô∏è Merci de remplir tous les champs.");

      const { data, error } = await supabase.auth.signUp({ email, password });
      if (error) return alert("‚ùå " + error.message);

      if (data.user) {
        // tenter de cr√©er le profil (si la conf email n'emp√™che pas la session imm√©diate)
        const { error: pErr } = await supabase.from("profiles").insert([{ id: data.user.id, username }]);
        if (pErr) console.warn("‚ö†Ô∏è Profile:", pErr.message);
      }

      alert("‚úÖ Compte cr√©√© ! V√©rifie ton e-mail si n√©cessaire.");
      window.location.href = "/dashboard/";
    });

    // Logout
    logoutBtn?.addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "/";
    });

    // Cookie banner
    const cookieBanner = document.getElementById("cookieBanner");
    const acceptBtn = document.getElementById("acceptCookies");
    if (localStorage.getItem("cookiesAccepted")) {
      cookieBanner.style.display = "none";
    }
    acceptBtn.addEventListener("click", () => {
      localStorage.setItem("cookiesAccepted", "true");
      cookieBanner.style.display = "none";
    });
  </script>
</body>
</html>
